---
title: "Time Series Forecasting"
execute:
  warning: false
  message: false
---

We conducted time series analysis to forecast unemployment rates for the 2026 midterm election across three representative states using ARIMA models fit to historical data from 1976 to 2024.

```{r setup}
#| include: false
library(tidyverse)
library(forecast)
library(tseries)
library(knitr)
library(kableExtra)
```

```{r load-data}
#| include: false
# Load unemployment data
unemployment_df <- read_csv("data/processed-data/unemployment_df.csv")

# Prepare data for each state
fl_data <- unemployment_df %>%
  select(year, Florida) %>%
  rename(unemployment_rate = Florida) %>%
  arrange(year)

ca_data <- unemployment_df %>%
  select(year, California) %>%
  rename(unemployment_rate = California) %>%
  arrange(year)

mi_data <- unemployment_df %>%
  select(year, Michigan) %>%
  rename(unemployment_rate = Michigan) %>%
  arrange(year)

# Create time series objects
fl_ts <- ts(fl_data$unemployment_rate, start = 1976, frequency = 1)
ca_ts <- ts(ca_data$unemployment_rate, start = 1976, frequency = 1)
mi_ts <- ts(mi_data$unemployment_rate, start = 1976, frequency = 1)
```

## 2026 Unemployment Forecasts

```{r forecast-summary}
#| echo: false
# Fit final models based on analysis
fl_model <- Arima(fl_ts, order = c(2, 0, 0))
ca_model <- Arima(ca_ts, order = c(2, 0, 0))
mi_model <- Arima(mi_ts, order = c(0, 1, 0))

# Generate forecasts
fl_forecast <- forecast(fl_model, h = 2)
ca_forecast <- forecast(ca_model, h = 2)
mi_forecast <- forecast(mi_model, h = 2)

# Create summary table
tibble(
  State = c("Florida", "California", "Michigan"),
  Type = c("Red", "Blue", "Swing"),
  `2024 Rate` = c(
    sprintf("%.2f%%", tail(fl_ts, 1)),
    sprintf("%.2f%%", tail(ca_ts, 1)),
    sprintf("%.2f%%", tail(mi_ts, 1))
  ),
  `2026 Forecast` = c(
    sprintf("%.2f%%", fl_forecast$mean[2]),
    sprintf("%.2f%%", ca_forecast$mean[2]),
    sprintf("%.2f%%", mi_forecast$mean[2])
  ),
  Change = c(
    sprintf("+%.2f%%", fl_forecast$mean[2] - tail(fl_ts, 1)),
    sprintf("+%.2f%%", ca_forecast$mean[2] - tail(ca_ts, 1)),
    sprintf("+%.2f%%", mi_forecast$mean[2] - tail(mi_ts, 1))
  ),
  `95% CI` = c(
    sprintf("[%.2f%%, %.2f%%]", fl_forecast$lower[2, 2], fl_forecast$upper[2, 2]),
    sprintf("[%.2f%%, %.2f%%]", ca_forecast$lower[2, 2], ca_forecast$upper[2, 2]),
    sprintf("[%.2f%%, %.2f%%]", mi_forecast$lower[2, 2], mi_forecast$upper[2, 2])
  )
) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Florida Unemployment Forecast (Red State)

### Time Series Plot

```{r florida-ts-plot}
#| fig-width: 10
#| fig-height: 5
#| fig-cap: "Figure 17: Florida Unemployment Rate Over Time (1976-2024)"

ggplot(fl_data, aes(x = year, y = unemployment_rate)) +
  geom_line(color = "steelblue", linewidth = 1) +
  geom_point(color = "steelblue", size = 2) +
  labs(
    title = "Florida Unemployment Rate (1976-2024)",
    x = "Year",
    y = "Unemployment Rate (%)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14)
  )
```

### Stationarity Assessment

```{r florida-stationarity}
# ADF test on original series
adf_fl <- adf.test(fl_ts)

# Differencing
fl_diff <- diff(fl_ts, differences = 1)
adf_fl_diff <- adf.test(fl_diff)

tibble(
  Series = c("Original", "After Differencing"),
  `ADF Statistic` = c(adf_fl$statistic, adf_fl_diff$statistic),
  `p-value` = c(round(adf_fl$p.value, 3), round(adf_fl_diff$p.value, 3)),
  Conclusion = c(
    ifelse(adf_fl$p.value < 0.05, "Stationary", "Non-stationary"),
    ifelse(adf_fl_diff$p.value < 0.05, "Stationary", "Non-stationary")
  )
) %>%
  kable(caption = "Stationarity Testing: Florida") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

- **ADF test (original series):** p = `r round(adf_fl$p.value, 2)` (non-stationary)
- **ADF test (after differencing):** p < 0.01 (stationary)

First-order differencing was required to achieve stationarity.

### ACF and PACF Plots

```{r florida-acf-pacf}
#| fig-width: 10
#| fig-height: 4
#| fig-cap: "Figure 18: ACF and PACF Plots for Florida (Differenced Series)"

par(mfrow = c(1, 2))
acf(fl_diff, main = "ACF: Florida (Differenced)", lag.max = 20)
pacf(fl_diff, main = "PACF: Florida (Differenced)", lag.max = 20)
```

### Model Selection

```{r florida-models}
# Fit candidate models
fl_model1 <- Arima(fl_ts, order = c(0, 1, 1))
fl_model2 <- Arima(fl_ts, order = c(1, 1, 0))
fl_model3 <- Arima(fl_ts, order = c(1, 1, 1))
fl_model4 <- Arima(fl_ts, order = c(2, 1, 0))

# Auto ARIMA
fl_auto <- auto.arima(fl_ts, seasonal = FALSE)

tibble(
  Model = c("ARIMA(0,1,1)", "ARIMA(1,1,0)", "ARIMA(1,1,1)", "ARIMA(2,1,0)", "Auto ARIMA"),
  Specification = c("MA(1) with diff", "AR(1) with diff", "ARMA(1,1) with diff", "AR(2) with diff", paste0("ARIMA", paste0(arimaorder(fl_auto), collapse = ","))),
  AIC = c(AIC(fl_model1), AIC(fl_model2), AIC(fl_model3), AIC(fl_model4), AIC(fl_auto))
) %>%
  kable(caption = "Model Comparison: Florida", digits = 2) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

- **Best manual model:** ARIMA(0,1,1), AIC = `r round(AIC(fl_model1), 2)`
- **Auto.arima selection:** ARIMA(`r paste0(arimaorder(fl_auto), collapse = ",")`), AIC = `r round(AIC(fl_auto), 2)`

ARIMA(`r paste0(arimaorder(fl_auto), collapse = ",")`) demonstrated superior fit.

### Forecast

```{r florida-forecast-plot}
#| fig-width: 10
#| fig-height: 6
#| fig-cap: "Figure 19: Florida Unemployment Forecast (2025-2026)"

# Create forecast dataframe
forecast_df_fl <- data.frame(
  year = c(time(fl_ts), 2025, 2026),
  actual = c(as.numeric(fl_ts), NA, NA),
  forecast = c(rep(NA, length(fl_ts)), fl_forecast$mean[1], fl_forecast$mean[2]),
  lower = c(rep(NA, length(fl_ts)), fl_forecast$lower[1, 2], fl_forecast$lower[2, 2]),
  upper = c(rep(NA, length(fl_ts)), fl_forecast$upper[1, 2], fl_forecast$upper[2, 2])
)

ggplot(forecast_df_fl) +
  geom_line(aes(x = year, y = actual), color = "steelblue", linewidth = 1) +
  geom_line(aes(x = year, y = forecast), color = "red", linetype = "dashed", linewidth = 1) +
  geom_ribbon(aes(x = year, ymin = lower, ymax = upper), fill = "red", alpha = 0.2) +
  labs(
    title = "Florida Unemployment: Historical and Forecasted",
    x = "Year",
    y = "Unemployment Rate (%)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 14))
```

**Florida unemployment is forecast to rise from `r round(tail(fl_ts, 1), 2)`% in 2024 to `r round(fl_forecast$mean[2], 2)`% in 2026**, representing an increase of **`r round(fl_forecast$mean[2] - tail(fl_ts, 1), 2)` percentage points** (95% CI: [`r round(fl_forecast$lower[2, 2], 2)`%, `r round(fl_forecast$upper[2, 2], 2)`%]).

## California Unemployment Forecast (Blue State)

### Time Series Plot

```{r california-ts-plot}
#| fig-width: 10
#| fig-height: 5
#| fig-cap: "Figure 20: California Unemployment Rate Over Time (1976-2024)"

ggplot(ca_data, aes(x = year, y = unemployment_rate)) +
  geom_line(color = "steelblue", linewidth = 1) +
  geom_point(color = "steelblue", size = 2) +
  labs(
    title = "California Unemployment Rate (1976-2024)",
    x = "Year",
    y = "Unemployment Rate (%)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 14))
```

### Stationarity Assessment

```{r california-stationarity}
# ADF test on original series
adf_ca <- adf.test(ca_ts)

# Differencing
ca_diff <- diff(ca_ts, differences = 1)
adf_ca_diff <- adf.test(ca_diff)

tibble(
  Series = c("Original", "After Differencing"),
  `ADF Statistic` = c(adf_ca$statistic, adf_ca_diff$statistic),
  `p-value` = c(round(adf_ca$p.value, 3), round(adf_ca_diff$p.value, 3)),
  Conclusion = c(
    ifelse(adf_ca$p.value < 0.05, "Stationary", "Non-stationary"),
    ifelse(adf_ca_diff$p.value < 0.05, "Stationary", "Non-stationary")
  )
) %>%
  kable(caption = "Stationarity Testing: California") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

- **ADF test (original series):** p = `r round(adf_ca$p.value, 2)` (non-stationary)
- **ADF test (after differencing):** p < 0.01 (stationary)

First-order differencing was applied.

### ACF and PACF Plots

```{r california-acf-pacf}
#| fig-width: 10
#| fig-height: 4
#| fig-cap: "Figure 21: ACF and PACF Plots for California (Differenced Series)"

par(mfrow = c(1, 2))
acf(ca_diff, main = "ACF: California (Differenced)", lag.max = 20)
pacf(ca_diff, main = "PACF: California (Differenced)", lag.max = 20)
```

### Model Selection

```{r california-models}
# Auto ARIMA
ca_auto <- auto.arima(ca_ts, seasonal = FALSE)

summary(ca_auto)
```

- **Auto.arima selection:** ARIMA(`r paste0(arimaorder(ca_auto), collapse = ",")`), AIC = `r round(AIC(ca_auto), 2)`

Interestingly, this matches Florida's specification despite opposing political contexts.

### Forecast

```{r california-forecast-plot}
#| fig-width: 10
#| fig-height: 6
#| fig-cap: "Figure 22: California Unemployment Forecast (2025-2026)"

# Create forecast dataframe
forecast_df_ca <- data.frame(
  year = c(time(ca_ts), 2025, 2026),
  actual = c(as.numeric(ca_ts), NA, NA),
  forecast = c(rep(NA, length(ca_ts)), ca_forecast$mean[1], ca_forecast$mean[2]),
  lower = c(rep(NA, length(ca_ts)), ca_forecast$lower[1, 2], ca_forecast$lower[2, 2]),
  upper = c(rep(NA, length(ca_ts)), ca_forecast$upper[1, 2], ca_forecast$upper[2, 2])
)

ggplot(forecast_df_ca) +
  geom_line(aes(x = year, y = actual), color = "steelblue", linewidth = 1) +
  geom_line(aes(x = year, y = forecast), color = "red", linetype = "dashed", linewidth = 1) +
  geom_ribbon(aes(x = year, ymin = lower, ymax = upper), fill = "red", alpha = 0.2) +
  labs(
    title = "California Unemployment: Historical and Forecasted",
    x = "Year",
    y = "Unemployment Rate (%)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 14))
```

**California unemployment is forecast to rise from `r round(tail(ca_ts, 1), 2)`% in 2024 to `r round(ca_forecast$mean[2], 2)`% in 2026**, an increase of **`r round(ca_forecast$mean[2] - tail(ca_ts, 1), 2)` percentage points** (95% CI: [`r round(ca_forecast$lower[2, 2], 2)`%, `r round(ca_forecast$upper[2, 2], 2)`%]).

## Michigan Unemployment Forecast (Swing State)

### Time Series Plot

```{r michigan-ts-plot}
#| fig-width: 10
#| fig-height: 5
#| fig-cap: "Figure 23: Michigan Unemployment Rate Over Time (1976-2024)"

ggplot(mi_data, aes(x = year, y = unemployment_rate)) +
  geom_line(color = "steelblue", linewidth = 1) +
  geom_point(color = "steelblue", size = 2) +
  labs(
    title = "Michigan Unemployment Rate (1976-2024)",
    x = "Year",
    y = "Unemployment Rate (%)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 14))
```

### Stationarity Assessment

```{r michigan-stationarity}
# ADF test on original series
adf_mi <- adf.test(mi_ts)

# Differencing
mi_diff <- diff(mi_ts, differences = 1)
adf_mi_diff <- adf.test(mi_diff)

tibble(
  Series = c("Original", "After Differencing"),
  `ADF Statistic` = c(adf_mi$statistic, adf_mi_diff$statistic),
  `p-value` = c(round(adf_mi$p.value, 3), round(adf_mi_diff$p.value, 3)),
  Conclusion = c(
    ifelse(adf_mi$p.value < 0.05, "Stationary", "Non-stationary"),
    ifelse(adf_mi_diff$p.value < 0.05, "Stationary", "Non-stationary")
  )
) %>%
  kable(caption = "Stationarity Testing: Michigan") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

- **ADF test (original series):** p = `r round(adf_mi$p.value, 2)` (non-stationary)
- **ADF test (after differencing):** p < 0.01 (stationary)

### Model Selection

```{r michigan-models}
# Auto ARIMA
mi_auto <- auto.arima(mi_ts, seasonal = FALSE)

summary(mi_auto)
```

- **Auto.arima selection:** ARIMA(`r paste0(arimaorder(mi_auto), collapse = ",")`), AIC = `r round(AIC(mi_auto), 2)`

This is a **random walk specification**, reflecting higher volatility in manufacturing-dependent economies. This simpler structure contrasts sharply with the AR(2) models for Florida and California.

### Forecast

```{r michigan-forecast-plot}
#| fig-width: 10
#| fig-height: 6
#| fig-cap: "Figure 24: Michigan Unemployment Forecast (2025-2026)"

# Create forecast dataframe
forecast_df_mi <- data.frame(
  year = c(time(mi_ts), 2025, 2026),
  actual = c(as.numeric(mi_ts), NA, NA),
  forecast = c(rep(NA, length(mi_ts)), mi_forecast$mean[1], mi_forecast$mean[2]),
  lower = c(rep(NA, length(mi_ts)), mi_forecast$lower[1, 2], mi_forecast$lower[2, 2]),
  upper = c(rep(NA, length(mi_ts)), mi_forecast$upper[1, 2], mi_forecast$upper[2, 2])
)

ggplot(forecast_df_mi) +
  geom_line(aes(x = year, y = actual), color = "steelblue", linewidth = 1) +
  geom_line(aes(x = year, y = forecast), color = "red", linetype = "dashed", linewidth = 1) +
  geom_ribbon(aes(x = year, ymin = lower, ymax = upper), fill = "red", alpha = 0.2) +
  labs(
    title = "Michigan Unemployment: Historical and Forecasted",
    x = "Year",
    y = "Unemployment Rate (%)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 14))
```

**Michigan unemployment is forecast to rise from `r round(tail(mi_ts, 1), 2)`% to `r round(mi_forecast$mean[2], 2)`% in 2026**, an increase of **`r round(mi_forecast$mean[2] - tail(mi_ts, 1), 2)` percentage points** (95% CI: [`r round(mi_forecast$lower[2, 2], 2)`%, `r round(mi_forecast$upper[2, 2], 2)`%]). The wide confidence interval reflects substantial forecast uncertainty.

## Comparative Analysis

### Model Specifications

- **Florida & California:** Both exhibit ARIMA(`r paste0(arimaorder(fl_auto), collapse = ",")`) specifications, indicating comparable economic stability across partisan contexts
- **Michigan:** ARIMA(`r paste0(arimaorder(mi_auto), collapse = ",")`) reflects manufacturing-sector volatility, evidenced by large cyclical swings during the 1982, 2008, and 2020 recessions

### Forecast Convergence

All three states forecast **rising unemployment** heading into 2026:

- **Largest increase:** Florida (+`r round(fl_forecast$mean[2] - tail(fl_ts, 1), 2)` percentage points)
- **Moderate increases:** California (+`r round(ca_forecast$mean[2] - tail(ca_ts, 1), 2)`), Michigan (+`r round(mi_forecast$mean[2] - tail(mi_ts, 1), 2)`)

Despite historical differences, forecasts converge to similar levels (`r round(min(fl_forecast$mean[2], ca_forecast$mean[2], mi_forecast$mean[2]), 2)`% to `r round(max(fl_forecast$mean[2], ca_forecast$mean[2], mi_forecast$mean[2]), 2)`%), though confidence intervals span 5.3 to 7.1 percentage points, reflecting considerable uncertainty.

## Implications

### Limited Predictive Power for Turnout

Given the weak unemployment-turnout correlation identified earlier (p = 0.0217), these forecasts provide **economic context but limited predictive power for voter participation.**

### Differential Predictability

The key finding concerns differential predictability:

- **Stable economies (Florida & California):** Enable reliable forecasting
- **Volatile economy (Michigan):** Complicates prediction and suggests swing state campaigns must account for greater economic uncertainty

### 2026 Context

All three states are entering the 2026 midterm with rising unemployment, which may influence campaign messaging around economic issues, though the direct effect on turnout appears modest based on our earlier analyses.

## Methodological Notes

- **Stationarity:** Assessed via ADF test and ACF plots
- **Model selection:** Manual specification + auto.arima comparison
- **Evaluation criteria:** AIC, BIC, diagnostic checks
- **Forecasting horizon:** 2025-2026
- **Confidence intervals:** 95% level
